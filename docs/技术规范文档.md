# æ¯æ—¥åŠ±å¿—è¯­å½•ç³»ç»Ÿ - æŠ€æœ¯è§„èŒƒæ–‡æ¡£

## 1. æŠ€æœ¯æ¶æ„è®¾è®¡

### 1.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯å±‚ (Frontend)                    â”‚
â”‚            Next.js 14 + React 18 + TypeScript           â”‚
â”‚              TailwindCSS + Framer Motion                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTPS/JSON
                  â”‚ JWT Token
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åç«¯å±‚ (Backend)                     â”‚
â”‚              Flask 3.0 + Python 3.10+                   â”‚
â”‚              Flask-SQLAlchemy + Flask-JWT               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL â”‚    â”‚  DeepSeek API  â”‚  â”‚ å’Œé£å¤©æ°” â”‚  â”‚   Redis    â”‚
â”‚   æ•°æ®åº“     â”‚    â”‚   AIç”ŸæˆæœåŠ¡    â”‚  â”‚   API   â”‚  â”‚  ç¼“å­˜/é™æµ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 1.2 æŠ€æœ¯æ ˆé€‰å‹

#### 1.2.1 å‰ç«¯æŠ€æœ¯æ ˆ
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|------|------|------|----------|
| Next.js | 14.x | Reactæ¡†æ¶ | SSRæ”¯æŒã€ä¼˜ç§€çš„SEOã€è‡ªåŠ¨ä»£ç åˆ†å‰² |
| React | 18.x | UIåº“ | ç»„ä»¶åŒ–å¼€å‘ã€ç”Ÿæ€æˆç†Ÿ |
| TypeScript | 5.x | ç±»å‹ç³»ç»Ÿ | ç±»å‹å®‰å…¨ã€ä»£ç å¯ç»´æŠ¤æ€§é«˜ |
| TailwindCSS | 3.x | CSSæ¡†æ¶ | åŸå­åŒ–CSSã€å¼€å‘æ•ˆç‡é«˜ |
| Framer Motion | 11.x | åŠ¨ç”»åº“ | æµç•…åŠ¨ç”»ã€ä¸­å›½é£ç”»å·æ•ˆæœ |
| Zustand | 4.x | çŠ¶æ€ç®¡ç† | è½»é‡çº§ã€APIç®€æ´ |
| Axios | 1.x | HTTPå®¢æˆ·ç«¯ | æ‹¦æˆªå™¨æ”¯æŒã€Promise API |
| React Hook Form | 7.x | è¡¨å•ç®¡ç† | é«˜æ€§èƒ½ã€éªŒè¯åŠŸèƒ½å¼ºå¤§ |
| date-fns | 3.x | æ—¥æœŸå¤„ç† | æ¨¡å—åŒ–ã€Tree-shakingå‹å¥½ |

#### 1.2.2 åç«¯æŠ€æœ¯æ ˆ
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|------|------|------|----------|
| Python | 3.10+ | ç¼–ç¨‹è¯­è¨€ | ç”Ÿæ€ä¸°å¯Œã€AIé›†æˆæ–¹ä¾¿ |
| Flask | 3.0+ | Webæ¡†æ¶ | è½»é‡çº§ã€çµæ´»æ€§é«˜ |
| Flask-SQLAlchemy | 3.1+ | ORMæ¡†æ¶ | ç®€åŒ–æ•°æ®åº“æ“ä½œ |
| Flask-JWT-Extended | 4.6+ | JWTè®¤è¯ | å®‰å…¨çš„Tokenç®¡ç† |
| Flask-CORS | 4.0+ | è·¨åŸŸæ”¯æŒ | å‰åç«¯åˆ†ç¦»å¿…éœ€ |
| Flask-Limiter | 3.5+ | æ¥å£é™æµ | é˜²æ­¢APIæ»¥ç”¨ |
| bcrypt | 4.1+ | å¯†ç åŠ å¯† | è¡Œä¸šæ ‡å‡†åŠ å¯†ç®—æ³• |
| requests | 2.31+ | HTTPå®¢æˆ·ç«¯ | è°ƒç”¨å¤–éƒ¨API |
| python-dotenv | 1.0+ | ç¯å¢ƒå˜é‡ | é…ç½®ç®¡ç† |
| gunicorn | 21.2+ | WSGIæœåŠ¡å™¨ | ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² |

#### 1.2.3 æ•°æ®åº“ä¸ç¼“å­˜
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| PostgreSQL | 15+ | ä¸»æ•°æ®åº“ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ |
| SQLite | 3.x | å¼€å‘ç¯å¢ƒæ•°æ®åº“ |
| Redis | 7.0+ | ç¼“å­˜ã€æ¥å£é™æµ |

---

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 å‰ç«¯æ¶æ„

#### 2.1.1 ç›®å½•ç»“æ„
```
daily-advice/
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/                    # Next.js 14 App Router
â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/            # è®¤è¯è·¯ç”±ç»„
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ register/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ (main)/            # ä¸»åº”ç”¨è·¯ç”±ç»„
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ home/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx         # æ ¹å¸ƒå±€
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx           # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ components/            # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/                # åŸºç¡€UIç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Loading.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/              # è®¤è¯ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginForm.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ RegisterForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ quote/             # è¯­å½•ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ QuoteDisplay.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ QuoteInput.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ EmotionIcon.tsx
â”‚   â”‚   â”‚   â””â”€â”€ layout/            # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚       â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚       â””â”€â”€ Footer.tsx
â”‚   â”‚   â”œâ”€â”€ lib/                   # å·¥å…·åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ api/               # APIå°è£…
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts     # Axioså®ä¾‹é…ç½®
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts       # è®¤è¯API
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ quote.ts      # è¯­å½•API
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useWeather.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ useGeolocation.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ store/             # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ authStore.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ quoteStore.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ date.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ validator.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ emotion.ts
â”‚   â”‚   â”‚   â””â”€â”€ constants/         # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”‚       â”œâ”€â”€ emotions.ts
â”‚   â”‚   â”‚       â””â”€â”€ config.ts
â”‚   â”‚   â”œâ”€â”€ styles/                # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â”‚   â””â”€â”€ animations.css     # åŠ¨ç”»æ ·å¼
â”‚   â”‚   â””â”€â”€ types/                 # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ user.ts
â”‚   â”‚       â”œâ”€â”€ quote.ts
â”‚   â”‚       â””â”€â”€ api.ts
â”‚   â”œâ”€â”€ public/                    # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ fonts/                 # å­—ä½“æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ images/                # å›¾ç‰‡èµ„æº
â”‚   â”‚   â””â”€â”€ textures/              # æ°´å¢¨çº¹ç†
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â””â”€â”€ next.config.js
```

#### 2.1.2 æ ¸å¿ƒç»„ä»¶è®¾è®¡

**QuoteDisplay ç»„ä»¶**ï¼ˆè¯­å½•å±•ç¤ºï¼‰
```typescript
interface QuoteDisplayProps {
  quote: string;
  emotion: EmotionType;
  isLoading: boolean;
  onRegenerate: () => void;
}

// åŠŸèƒ½ï¼š
// 1. ç”»å·å±•å¼€åŠ¨ç”»ï¼ˆFramer Motionï¼‰
// 2. æ‰“å­—æœºæ•ˆæœï¼ˆé€å­—æ˜¾ç¤ºï¼‰
// 3. æƒ…ç»ªè¡¨æƒ…åŠ¨ç”»
// 4. æ°´å¢¨èƒŒæ™¯çº¹ç†
```

**QuoteInput ç»„ä»¶**ï¼ˆç”¨æˆ·è¾“å…¥ï¼‰
```typescript
interface QuoteInputProps {
  onSubmit: (data: QuoteInputData) => void;
  isGenerating: boolean;
}

interface QuoteInputData {
  event?: string;
  mood?: string;
}

// åŠŸèƒ½ï¼š
// 1. å¯é€‰è¾“å…¥æ¡†ï¼ˆä»Šæ—¥å¤§äº‹ã€ç›®å‰å¿ƒæƒ…ï¼‰
// 2. å­—æ•°é™åˆ¶æç¤º
// 3. å®æ—¶éªŒè¯
```

---

### 2.2 åç«¯æ¶æ„

#### 2.2.1 ç›®å½•ç»“æ„
```
daily-advice/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py            # Flaskåº”ç”¨å·¥å‚
â”‚   â”‚   â”œâ”€â”€ models/                # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py           # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ quote.py          # è¯­å½•å†å²æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ api/                   # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py           # è®¤è¯ç›¸å…³API
â”‚   â”‚   â”‚   â”œâ”€â”€ quote.py          # è¯­å½•ç”ŸæˆAPI
â”‚   â”‚   â”‚   â””â”€â”€ user.py           # ç”¨æˆ·ä¿¡æ¯API
â”‚   â”‚   â”œâ”€â”€ services/              # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_service.py   # è®¤è¯æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ quote_service.py  # è¯­å½•ç”ŸæˆæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ ai_service.py     # AIè°ƒç”¨æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ weather_service.py # å¤©æ°”æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ validator.py      # æ•°æ®éªŒè¯
â”‚   â”‚   â”‚   â”œâ”€â”€ logger.py         # æ—¥å¿—é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ crypto.py         # åŠ å¯†å·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ response.py       # ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â”‚   â”œâ”€â”€ config/                # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ development.py
â”‚   â”‚   â”‚   â”œâ”€â”€ production.py
â”‚   â”‚   â”‚   â””â”€â”€ testing.py
â”‚   â”‚   â””â”€â”€ extensions.py          # Flaskæ‰©å±•åˆå§‹åŒ–
â”‚   â”œâ”€â”€ migrations/                # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”‚   â”œâ”€â”€ tests/                     # æµ‹è¯•æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ test_auth.py
â”‚   â”‚   â”œâ”€â”€ test_quote.py
â”‚   â”‚   â””â”€â”€ test_services.py
â”‚   â”œâ”€â”€ requirements.txt           # ä¾èµ–åˆ—è¡¨
â”‚   â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”‚   â””â”€â”€ run.py                    # å¯åŠ¨æ–‡ä»¶
```

#### 2.2.2 æ ¸å¿ƒæœåŠ¡è®¾è®¡

**AIæœåŠ¡ï¼ˆai_service.pyï¼‰**
```python
class AIService:
    """DeepSeek APIè°ƒç”¨æœåŠ¡"""

    @staticmethod
    def generate_quote(user_info, context_info):
        """
        ç”Ÿæˆæ¯æ—¥è¯­å½•

        å‚æ•°ï¼š
            user_info: ç”¨æˆ·ä¿¡æ¯å­—å…¸
            context_info: ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¤©æ°”ã€å¿ƒæƒ…ç­‰ï¼‰

        è¿”å›ï¼š
            ç”Ÿæˆçš„è¯­å½•å­—ç¬¦ä¸²
        """
        # 1. æ„å»ºæç¤ºè¯
        # 2. è°ƒç”¨DeepSeek API
        # 3. è§£æå“åº”
        # 4. éªŒè¯é•¿åº¦ï¼ˆ30-60å­—ï¼‰
        # 5. è¿”å›ç»“æœ
```

**å¤©æ°”æœåŠ¡ï¼ˆweather_service.pyï¼‰**
```python
class WeatherService:
    """å’Œé£å¤©æ°”APIè°ƒç”¨æœåŠ¡"""

    @staticmethod
    @cache_result(ttl=3600)  # ç¼“å­˜1å°æ—¶
    def get_current_weather(city):
        """
        è·å–å½“å‰å¤©æ°”

        å‚æ•°ï¼š
            city: åŸå¸‚åç§°

        è¿”å›ï¼š
            å¤©æ°”ä¿¡æ¯å­—å…¸
        """
        # 1. è°ƒç”¨å’Œé£å¤©æ°”API
        # 2. è§£æå¤©æ°”æ•°æ®
        # 3. è¿”å›æ ‡å‡†æ ¼å¼
```

---

## 3. æ•°æ®åº“è®¾è®¡

### 3.1 E-Rå›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Users     â”‚1      n â”‚  QuoteHistory   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)      â”‚         â”‚ id (PK)         â”‚
â”‚ phone (UK)   â”‚         â”‚ user_id (FK)    â”‚
â”‚ password_hashâ”‚         â”‚ quote_content   â”‚
â”‚ name         â”‚         â”‚ event_input     â”‚
â”‚ gender       â”‚         â”‚ mood_input      â”‚
â”‚ birthday     â”‚         â”‚ weather         â”‚
â”‚ created_at   â”‚         â”‚ temperature     â”‚
â”‚ last_login_atâ”‚         â”‚ city            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ is_birthday     â”‚
                         â”‚ created_at      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ•°æ®è¡¨è¯¦ç»†è®¾è®¡

#### 3.2.1 usersè¡¨ï¼ˆç”¨æˆ·è¡¨ï¼‰
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    phone VARCHAR(11) UNIQUE NOT NULL,
    password_hash VARCHAR(128) NOT NULL,
    name VARCHAR(50) NOT NULL,
    gender VARCHAR(10) NOT NULL CHECK (gender IN ('male', 'female', 'other')),
    birthday DATE NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_login_at TIMESTAMP,

    -- ç´¢å¼•
    CONSTRAINT uk_phone UNIQUE (phone),
    CONSTRAINT chk_birthday CHECK (birthday <= CURRENT_DATE - INTERVAL '18 years')
);

CREATE INDEX idx_users_phone ON users(phone);
CREATE INDEX idx_users_birthday ON users(birthday);
```

#### 3.2.2 quote_historyè¡¨ï¼ˆè¯­å½•å†å²è¡¨ï¼‰
```sql
CREATE TABLE quote_history (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL,
    quote_content TEXT NOT NULL,
    event_input VARCHAR(200),
    mood_input VARCHAR(100),
    weather VARCHAR(50) NOT NULL,
    temperature INTEGER NOT NULL,
    city VARCHAR(50) NOT NULL,
    is_birthday BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    -- å¤–é”®çº¦æŸ
    CONSTRAINT fk_user FOREIGN KEY (user_id)
        REFERENCES users(id) ON DELETE CASCADE
);

CREATE INDEX idx_quote_user_id ON quote_history(user_id);
CREATE INDEX idx_quote_created_at ON quote_history(created_at);
CREATE INDEX idx_quote_user_date ON quote_history(user_id, created_at);
```

---

## 4. APIæ¥å£è®¾è®¡

### 4.1 æ¥å£è§„èŒƒ

#### 4.1.1 ç»Ÿä¸€å“åº”æ ¼å¼
```json
// æˆåŠŸå“åº”
{
  "code": 200,
  "message": "success",
  "data": {
    // å…·ä½“æ•°æ®
  }
}

// é”™è¯¯å“åº”
{
  "code": 400,
  "message": "é”™è¯¯æè¿°",
  "errors": {
    "field": "å­—æ®µé”™è¯¯è¯¦æƒ…"
  }
}
```

#### 4.1.2 HTTPçŠ¶æ€ç è§„èŒƒ
| çŠ¶æ€ç  | å«ä¹‰ | ä½¿ç”¨åœºæ™¯ |
|--------|------|----------|
| 200 | æˆåŠŸ | è¯·æ±‚æˆåŠŸå¤„ç† |
| 201 | åˆ›å»ºæˆåŠŸ | æ³¨å†ŒæˆåŠŸ |
| 400 | è¯·æ±‚é”™è¯¯ | å‚æ•°éªŒè¯å¤±è´¥ |
| 401 | æœªæˆæƒ | Tokenæ— æ•ˆæˆ–è¿‡æœŸ |
| 403 | ç¦æ­¢è®¿é—® | æƒé™ä¸è¶³ |
| 404 | èµ„æºä¸å­˜åœ¨ | ç”¨æˆ·ä¸å­˜åœ¨ |
| 429 | è¯·æ±‚è¿‡å¤š | è§¦å‘é™æµ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | å†…éƒ¨é”™è¯¯ |

---

### 4.2 è®¤è¯æ¥å£

#### 4.2.1 ç”¨æˆ·æ³¨å†Œ
```
POST /api/v1/auth/register
Content-Type: application/json
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "phone": "13800138000",
  "password": "Abc123456",
  "name": "å¼ ä¸‰",
  "gender": "male",
  "birthday": "1995-06-15"
}
```

**å“åº”ï¼š**
```json
{
  "code": 201,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "user_id": 1,
    "phone": "13800138000",
    "name": "å¼ ä¸‰"
  }
}
```

**é”™è¯¯å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 400,
  "message": "æ³¨å†Œå¤±è´¥",
  "errors": {
    "phone": "è¯¥æ‰‹æœºå·å·²æ³¨å†Œ",
    "password": "å¯†ç å¼ºåº¦ä¸è¶³"
  }
}
```

---

#### 4.2.2 ç”¨æˆ·ç™»å½•
```
POST /api/v1/auth/login
Content-Type: application/json
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "phone": "13800138000",
  "password": "Abc123456"
}
```

**å“åº”ï¼š**
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "phone": "13800138000",
      "name": "å¼ ä¸‰",
      "gender": "male",
      "birthday": "1995-06-15"
    }
  }
}
```

---

### 4.3 è¯­å½•æ¥å£

#### 4.3.1 ç”Ÿæˆæ¯æ—¥è¯­å½•
```
POST /api/v1/quote/generate
Authorization: Bearer <token>
Content-Type: application/json
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "event": "ä»Šå¤©è¦å‚åŠ é‡è¦ä¼šè®®",  // å¯é€‰
  "mood": "æœ‰ç‚¹ç´§å¼ ",            // å¯é€‰
  "city": "åŒ—äº¬",               // å¯é€‰ï¼ˆä¸ä¼ åˆ™ä½¿ç”¨IPå®šä½ï¼‰
  "latitude": 39.9042,          // å¯é€‰
  "longitude": 116.4074         // å¯é€‰
}
```

**å“åº”ï¼š**
```json
{
  "code": 200,
  "message": "ç”ŸæˆæˆåŠŸ",
  "data": {
    "quote_id": 123,
    "content": "ç´§å¼ æ˜¯æˆé•¿çš„ä¿¡å·ï¼Œå¼ ä¸‰ï¼Œä»Šæ—¥åŒ—äº¬æ™´ç©ºä¸‡é‡Œï¼Œæ­£å¦‚ä½ å³å°†åœ¨ä¼šè®®ä¸­å±•ç°çš„æ¸…æ™°æ€è·¯ã€‚æ·±å‘¼å¸ï¼Œä½ å·²å‡†å¤‡å……åˆ†ã€‚",
    "emotion": "nervous",
    "emotion_icon": "ğŸ˜°",
    "emotion_color": "#4169e1",
    "weather": {
      "condition": "æ™´",
      "temperature": 25,
      "city": "åŒ—äº¬"
    },
    "is_birthday": false,
    "created_at": "2025-01-03T14:30:00Z"
  }
}
```

---

#### 4.3.2 è·å–å†å²è¯­å½•
```
GET /api/v1/quote/history?page=1&per_page=10
Authorization: Bearer <token>
```

**å“åº”ï¼š**
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "quotes": [
      {
        "id": 123,
        "content": "...",
        "mood_input": "ç´§å¼ ",
        "weather": "æ™´",
        "temperature": 25,
        "created_at": "2025-01-03T14:30:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "per_page": 10,
      "total": 45,
      "pages": 5
    }
  }
}
```

---

## 5. å®‰å…¨è®¾è®¡

### 5.1 è®¤è¯ä¸æˆæƒ

#### 5.1.1 JWT Tokenè®¾è®¡
```python
# Token payloadç»“æ„
{
  "user_id": 1,
  "phone": "13800138000",
  "exp": 1704276000,  # è¿‡æœŸæ—¶é—´ï¼ˆ7å¤©åï¼‰
  "iat": 1703671200   # ç­¾å‘æ—¶é—´
}

# Tokené…ç½®
JWT_SECRET_KEY = os.getenv('JWT_SECRET_KEY')
JWT_ACCESS_TOKEN_EXPIRES = timedelta(days=7)
JWT_ALGORITHM = 'HS256'
```

#### 5.1.2 å¯†ç åŠ å¯†
```python
from bcrypt import hashpw, gensalt, checkpw

# æ³¨å†Œæ—¶åŠ å¯†
password_hash = hashpw(password.encode('utf-8'), gensalt(rounds=12))

# ç™»å½•æ—¶éªŒè¯
is_valid = checkpw(password.encode('utf-8'), stored_hash)
```

---

### 5.2 æ•°æ®éªŒè¯

#### 5.2.1 è¾“å…¥éªŒè¯è§„åˆ™
```python
from marshmallow import Schema, fields, validate

class RegisterSchema(Schema):
    phone = fields.Str(
        required=True,
        validate=validate.Regexp(r'^1[3-9]\d{9}$', error="æ‰‹æœºå·æ ¼å¼é”™è¯¯")
    )
    password = fields.Str(
        required=True,
        validate=[
            validate.Length(min=8, max=20, error="å¯†ç é•¿åº¦8-20ä½"),
            validate.Regexp(
                r'^(?=.*[A-Za-z])(?=.*\d).+$',
                error="å¯†ç å¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—"
            )
        ]
    )
    name = fields.Str(
        required=True,
        validate=validate.Length(min=2, max=20, error="å§“åé•¿åº¦2-20å­—ç¬¦")
    )
    gender = fields.Str(
        required=True,
        validate=validate.OneOf(['male', 'female', 'other'])
    )
    birthday = fields.Date(required=True)
```

#### 5.2.2 XSSé˜²æŠ¤
```python
from markupsafe import escape

def sanitize_input(text):
    """å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè½¬ä¹‰"""
    return escape(text).strip()
```

---

### 5.3 æ¥å£é™æµ

#### 5.3.1 é™æµç­–ç•¥
```python
from flask_limiter import Limiter
from flask_limiter.util import get_remote_address

limiter = Limiter(
    key_func=get_remote_address,
    storage_uri="redis://localhost:6379"
)

# é™æµè£…é¥°å™¨
@limiter.limit("10 per minute")  # æ¯åˆ†é’Ÿ10æ¬¡
@limiter.limit("100 per hour")   # æ¯å°æ—¶100æ¬¡
def generate_quote():
    pass
```

---

## 6. å¤–éƒ¨APIé›†æˆ

### 6.1 DeepSeek APIé›†æˆ

#### 6.1.1 é…ç½®
```python
DEEPSEEK_API_KEY = os.getenv('DEEPSEEK_API_KEY')
DEEPSEEK_API_URL = 'https://api.deepseek.com/v1/chat/completions'
DEEPSEEK_MODEL = 'deepseek-chat'
```

#### 6.1.2 è°ƒç”¨ç¤ºä¾‹
```python
import requests

def call_deepseek_api(prompt):
    headers = {
        'Authorization': f'Bearer {DEEPSEEK_API_KEY}',
        'Content-Type': 'application/json'
    }

    payload = {
        'model': DEEPSEEK_MODEL,
        'messages': [
            {
                'role': 'system',
                'content': 'ä½ æ˜¯ä¸€ä½å¯Œæœ‰æƒ…æ„Ÿæ™ºæ…§çš„åŠ±å¿—å¯¼å¸ˆã€‚'
            },
            {
                'role': 'user',
                'content': prompt
            }
        ],
        'temperature': 0.8,
        'max_tokens': 200
    }

    response = requests.post(
        DEEPSEEK_API_URL,
        headers=headers,
        json=payload,
        timeout=10
    )

    if response.status_code == 200:
        data = response.json()
        return data['choices'][0]['message']['content'].strip()
    else:
        raise APIError(f"DeepSeek API error: {response.text}")
```

---

### 6.2 å’Œé£å¤©æ°”APIé›†æˆ

#### 6.2.1 é…ç½®
```python
QWEATHER_API_KEY = os.getenv('QWEATHER_API_KEY')
QWEATHER_API_URL = 'https://devapi.qweather.com/v7/weather/now'
```

#### 6.2.2 è°ƒç”¨ç¤ºä¾‹
```python
def get_weather(city):
    # 1. å…ˆé€šè¿‡åŸå¸‚åè·å–location_id
    location = get_location_id(city)

    # 2. è·å–å®æ—¶å¤©æ°”
    params = {
        'location': location,
        'key': QWEATHER_API_KEY
    }

    response = requests.get(QWEATHER_API_URL, params=params, timeout=5)

    if response.status_code == 200:
        data = response.json()
        return {
            'condition': data['now']['text'],
            'temperature': int(data['now']['temp']),
            'city': city
        }
    else:
        # è¿”å›é»˜è®¤å¤©æ°”
        return {'condition': 'æœªçŸ¥', 'temperature': 20, 'city': city}
```

---

## 7. éƒ¨ç½²æ¶æ„

### 7.1 å¼€å‘ç¯å¢ƒ

```bash
# å‰ç«¯
cd frontend
npm run dev  # localhost:3000

# åç«¯
cd backend
flask run --port=5000

# æ•°æ®åº“
SQLite (æœ¬åœ°æ–‡ä»¶æ•°æ®åº“)
```

---

### 7.2 ç”Ÿäº§ç¯å¢ƒ

#### 7.2.1 æœåŠ¡å™¨æ¶æ„
```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Nginx     â”‚
                    â”‚   (åå‘ä»£ç†)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚  Next.js SSR   â”‚      â”‚   Gunicorn  â”‚
        â”‚   (Port 3000)  â”‚      â”‚  Flask App  â”‚
        â”‚                â”‚      â”‚ (Port 5000) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                â”‚  PostgreSQL  â”‚              â”‚    Redis     â”‚
                â”‚  (Port 5432) â”‚              â”‚  (Port 6379) â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 7.2.2 Nginxé…ç½®ç¤ºä¾‹
```nginx
server {
    listen 80;
    server_name dailyadvice.com;

    # å‰ç«¯
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # åç«¯API
    location /api/ {
        proxy_pass http://localhost:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

---

## 8. æ€§èƒ½ä¼˜åŒ–

### 8.1 å‰ç«¯ä¼˜åŒ–

| ä¼˜åŒ–é¡¹ | æ–¹æ¡ˆ |
|--------|------|
| å›¾ç‰‡åŠ è½½ | WebPæ ¼å¼ + æ‡’åŠ è½½ + Next.js Imageç»„ä»¶ |
| ä»£ç åˆ†å‰² | Next.jsè‡ªåŠ¨ä»£ç åˆ†å‰² + åŠ¨æ€å¯¼å…¥ |
| å­—ä½“ä¼˜åŒ– | font-display: swap + å­—ä½“å­é›†åŒ– |
| ç¼“å­˜ç­–ç•¥ | Service Workerç¼“å­˜é™æ€èµ„æº |
| é¦–å±æ¸²æŸ“ | SSR + éª¨æ¶å± |

---

### 8.2 åç«¯ä¼˜åŒ–

| ä¼˜åŒ–é¡¹ | æ–¹æ¡ˆ |
|--------|------|
| æ•°æ®åº“æŸ¥è¯¢ | æ·»åŠ ç´¢å¼• + æŸ¥è¯¢ä¼˜åŒ– |
| APIå“åº”ç¼“å­˜ | Redisç¼“å­˜å¤©æ°”æ•°æ®ï¼ˆ1å°æ—¶ï¼‰ |
| è¿æ¥æ±  | SQLAlchemyè¿æ¥æ± ï¼ˆpool_size=10ï¼‰ |
| å¼‚æ­¥å¤„ç† | AIç”Ÿæˆä½¿ç”¨Celeryå¼‚æ­¥ä»»åŠ¡ï¼ˆå¯é€‰ï¼‰ |

---

## 9. æ—¥å¿—ä¸ç›‘æ§

### 9.1 æ—¥å¿—é…ç½®

```python
import logging
from logging.handlers import RotatingFileHandler

# æ—¥å¿—æ ¼å¼
LOG_FORMAT = '%(asctime)s - %(name)s - %(levelname)s - %(message)s'

# é…ç½®æ–‡ä»¶æ—¥å¿—
file_handler = RotatingFileHandler(
    'logs/app.log',
    maxBytes=10*1024*1024,  # 10MB
    backupCount=5
)
file_handler.setLevel(logging.INFO)
file_handler.setFormatter(logging.Formatter(LOG_FORMAT))

# é”™è¯¯æ—¥å¿—å•ç‹¬è®°å½•
error_handler = RotatingFileHandler(
    'logs/error.log',
    maxBytes=10*1024*1024,
    backupCount=5
)
error_handler.setLevel(logging.ERROR)
error_handler.setFormatter(logging.Formatter(LOG_FORMAT))
```

---

## 10. æµ‹è¯•ç­–ç•¥

### 10.1 å‰ç«¯æµ‹è¯•
- **å•å…ƒæµ‹è¯•**ï¼šJest + React Testing Library
- **E2Eæµ‹è¯•**ï¼šPlaywright
- **è¦†ç›–ç‡ç›®æ ‡**ï¼š> 80%

### 10.2 åç«¯æµ‹è¯•
- **å•å…ƒæµ‹è¯•**ï¼špytest
- **æ¥å£æµ‹è¯•**ï¼špytest + Flask test client
- **è¦†ç›–ç‡ç›®æ ‡**ï¼š> 85%

---

## 11. ç¼–ç è§„èŒƒ

### 11.1 å‰ç«¯è§„èŒƒ

#### 11.1.1 å‘½åè§„èŒƒ
- **ç»„ä»¶å**ï¼šPascalCaseï¼ˆå¦‚ `QuoteDisplay.tsx`ï¼‰
- **å‡½æ•°å**ï¼šcamelCaseï¼ˆå¦‚ `generateQuote()`ï¼‰
- **å¸¸é‡**ï¼šUPPER_SNAKE_CASEï¼ˆå¦‚ `API_BASE_URL`ï¼‰
- **CSSç±»å**ï¼škebab-caseï¼ˆå¦‚ `quote-container`ï¼‰

#### 11.1.2 TypeScriptè§„èŒƒ
```typescript
// æ˜¾å¼ç±»å‹æ³¨è§£
function generateQuote(userId: number): Promise<Quote> {
  // ...
}

// æ¥å£ä¼˜äºç±»å‹åˆ«åï¼ˆå¤æ‚å¯¹è±¡ï¼‰
interface User {
  id: number;
  name: string;
  birthday: Date;
}

// é¿å…anyï¼Œä½¿ç”¨unknownæˆ–å…·ä½“ç±»å‹
```

---

### 11.2 åç«¯è§„èŒƒ

#### 11.2.1 å‘½åè§„èŒƒ
- **æ–‡ä»¶å**ï¼šsnake_caseï¼ˆå¦‚ `auth_service.py`ï¼‰
- **ç±»å**ï¼šPascalCaseï¼ˆå¦‚ `UserModel`ï¼‰
- **å‡½æ•°å**ï¼šsnake_caseï¼ˆå¦‚ `generate_quote()`ï¼‰
- **å¸¸é‡**ï¼šUPPER_SNAKE_CASEï¼ˆå¦‚ `MAX_RETRY_COUNT`ï¼‰

#### 11.2.2 Pythonè§„èŒƒ
```python
# -*- coding: utf-8 -*-
"""æ¨¡å—æ–‡æ¡£å­—ç¬¦ä¸²"""

# PEP 8è§„èŒƒ
# 1. æ¯è¡Œæœ€å¤š79å­—ç¬¦
# 2. ä½¿ç”¨4ç©ºæ ¼ç¼©è¿›
# 3. å‡½æ•°é—´2ä¸ªç©ºè¡Œ

def generate_quote(user_id: int) -> dict:
    """
    ç”Ÿæˆæ¯æ—¥è¯­å½•

    Args:
        user_id: ç”¨æˆ·ID

    Returns:
        åŒ…å«è¯­å½•å†…å®¹çš„å­—å…¸

    Raises:
        ValueError: ç”¨æˆ·ä¸å­˜åœ¨
    """
    pass
```

---

## 12. ç¯å¢ƒå˜é‡é…ç½®

### 12.1 åç«¯ç¯å¢ƒå˜é‡ï¼ˆ.envï¼‰
```bash
# Flaské…ç½®
FLASK_ENV=development
FLASK_APP=run.py
SECRET_KEY=your-secret-key-here

# æ•°æ®åº“
DATABASE_URL=postgresql://user:pass@localhost:5432/daily_advice
# å¼€å‘ç¯å¢ƒå¯ç”¨ï¼šDATABASE_URL=sqlite:///dev.db

# JWTé…ç½®
JWT_SECRET_KEY=your-jwt-secret-key

# DeepSeek API
DEEPSEEK_API_KEY=your-deepseek-api-key

# å’Œé£å¤©æ°”API
QWEATHER_API_KEY=your-qweather-api-key

# Redis
REDIS_URL=redis://localhost:6379/0
```

### 12.2 å‰ç«¯ç¯å¢ƒå˜é‡ï¼ˆ.env.localï¼‰
```bash
NEXT_PUBLIC_API_BASE_URL=http://localhost:5000/api/v1
NEXT_PUBLIC_APP_NAME=æ¯æ—¥åŠ±å¿—è¯­å½•
```

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šV1.0
**ç¼–å†™æ—¥æœŸ**ï¼š2025-01-03
**ç¼–å†™äººå‘˜**ï¼šClaude Code
**å®¡æ ¸çŠ¶æ€**ï¼šå¾…å®¡æ ¸